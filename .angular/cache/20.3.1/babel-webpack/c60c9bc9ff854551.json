{"ast":null,"code":"/* global __webpack_dev_server_client__ */\n\nimport WebSocketClient from \"./clients/WebSocketClient.js\";\nimport { log } from \"./utils/log.js\";\n\n// this WebsocketClient is here as a default fallback, in case the client is not injected\n/* eslint-disable camelcase */\nvar Client =\n// eslint-disable-next-line no-nested-ternary\ntypeof __webpack_dev_server_client__ !== \"undefined\" ? typeof __webpack_dev_server_client__.default !== \"undefined\" ? __webpack_dev_server_client__.default : __webpack_dev_server_client__ : WebSocketClient;\n/* eslint-enable camelcase */\n\nvar retries = 0;\nvar maxRetries = 10;\n\n// Initialized client is exported so external consumers can utilize the same instance\n// It is mutable to enforce singleton\n// eslint-disable-next-line import/no-mutable-exports\nexport var client = null;\nvar timeout;\n\n/**\n * @param {string} url\n * @param {{ [handler: string]: (data?: any, params?: any) => any }} handlers\n * @param {number} [reconnect]\n */\nvar socket = function initSocket(url, handlers, reconnect) {\n  client = new Client(url);\n  client.onOpen(function () {\n    retries = 0;\n    if (timeout) {\n      clearTimeout(timeout);\n    }\n    if (typeof reconnect !== \"undefined\") {\n      maxRetries = reconnect;\n    }\n  });\n  client.onClose(function () {\n    if (retries === 0) {\n      handlers.close();\n    }\n\n    // Try to reconnect.\n    client = null;\n\n    // After 10 retries stop trying, to prevent logspam.\n    if (retries < maxRetries) {\n      // Exponentially increase timeout to reconnect.\n      // Respectfully copied from the package `got`.\n      // eslint-disable-next-line no-restricted-properties\n      var retryInMs = 1000 * Math.pow(2, retries) + Math.random() * 100;\n      retries += 1;\n      log.info(\"Trying to reconnect...\");\n      timeout = setTimeout(function () {\n        socket(url, handlers, reconnect);\n      }, retryInMs);\n    }\n  });\n  client.onMessage(\n  /**\n   * @param {any} data\n   */\n  function (data) {\n    var message = JSON.parse(data);\n    if (handlers[message.type]) {\n      handlers[message.type](message.data, message.params);\n    }\n  });\n};\nexport default socket;","map":{"version":3,"names":["WebSocketClient","log","Client","__webpack_dev_server_client__","default","retries","maxRetries","client","timeout","socket","initSocket","url","handlers","reconnect","onOpen","clearTimeout","onClose","close","retryInMs","Math","pow","random","info","setTimeout","onMessage","data","message","JSON","parse","type","params"],"sources":["/Users/saxis/dev/angular_projects/ha-kings/node_modules/webpack-dev-server/client/socket.js"],"sourcesContent":["/* global __webpack_dev_server_client__ */\n\nimport WebSocketClient from \"./clients/WebSocketClient.js\";\nimport { log } from \"./utils/log.js\";\n\n// this WebsocketClient is here as a default fallback, in case the client is not injected\n/* eslint-disable camelcase */\nvar Client =\n// eslint-disable-next-line no-nested-ternary\ntypeof __webpack_dev_server_client__ !== \"undefined\" ? typeof __webpack_dev_server_client__.default !== \"undefined\" ? __webpack_dev_server_client__.default : __webpack_dev_server_client__ : WebSocketClient;\n/* eslint-enable camelcase */\n\nvar retries = 0;\nvar maxRetries = 10;\n\n// Initialized client is exported so external consumers can utilize the same instance\n// It is mutable to enforce singleton\n// eslint-disable-next-line import/no-mutable-exports\nexport var client = null;\nvar timeout;\n\n/**\n * @param {string} url\n * @param {{ [handler: string]: (data?: any, params?: any) => any }} handlers\n * @param {number} [reconnect]\n */\nvar socket = function initSocket(url, handlers, reconnect) {\n  client = new Client(url);\n  client.onOpen(function () {\n    retries = 0;\n    if (timeout) {\n      clearTimeout(timeout);\n    }\n    if (typeof reconnect !== \"undefined\") {\n      maxRetries = reconnect;\n    }\n  });\n  client.onClose(function () {\n    if (retries === 0) {\n      handlers.close();\n    }\n\n    // Try to reconnect.\n    client = null;\n\n    // After 10 retries stop trying, to prevent logspam.\n    if (retries < maxRetries) {\n      // Exponentially increase timeout to reconnect.\n      // Respectfully copied from the package `got`.\n      // eslint-disable-next-line no-restricted-properties\n      var retryInMs = 1000 * Math.pow(2, retries) + Math.random() * 100;\n      retries += 1;\n      log.info(\"Trying to reconnect...\");\n      timeout = setTimeout(function () {\n        socket(url, handlers, reconnect);\n      }, retryInMs);\n    }\n  });\n  client.onMessage(\n  /**\n   * @param {any} data\n   */\n  function (data) {\n    var message = JSON.parse(data);\n    if (handlers[message.type]) {\n      handlers[message.type](message.data, message.params);\n    }\n  });\n};\nexport default socket;"],"mappings":"AAAA;;AAEA,OAAOA,eAAe,MAAM,8BAA8B;AAC1D,SAASC,GAAG,QAAQ,gBAAgB;;AAEpC;AACA;AACA,IAAIC,MAAM;AACV;AACA,OAAOC,6BAA6B,KAAK,WAAW,GAAG,OAAOA,6BAA6B,CAACC,OAAO,KAAK,WAAW,GAAGD,6BAA6B,CAACC,OAAO,GAAGD,6BAA6B,GAAGH,eAAe;AAC7M;;AAEA,IAAIK,OAAO,GAAG,CAAC;AACf,IAAIC,UAAU,GAAG,EAAE;;AAEnB;AACA;AACA;AACA,OAAO,IAAIC,MAAM,GAAG,IAAI;AACxB,IAAIC,OAAO;;AAEX;AACA;AACA;AACA;AACA;AACA,IAAIC,MAAM,GAAG,SAASC,UAAUA,CAACC,GAAG,EAAEC,QAAQ,EAAEC,SAAS,EAAE;EACzDN,MAAM,GAAG,IAAIL,MAAM,CAACS,GAAG,CAAC;EACxBJ,MAAM,CAACO,MAAM,CAAC,YAAY;IACxBT,OAAO,GAAG,CAAC;IACX,IAAIG,OAAO,EAAE;MACXO,YAAY,CAACP,OAAO,CAAC;IACvB;IACA,IAAI,OAAOK,SAAS,KAAK,WAAW,EAAE;MACpCP,UAAU,GAAGO,SAAS;IACxB;EACF,CAAC,CAAC;EACFN,MAAM,CAACS,OAAO,CAAC,YAAY;IACzB,IAAIX,OAAO,KAAK,CAAC,EAAE;MACjBO,QAAQ,CAACK,KAAK,CAAC,CAAC;IAClB;;IAEA;IACAV,MAAM,GAAG,IAAI;;IAEb;IACA,IAAIF,OAAO,GAAGC,UAAU,EAAE;MACxB;MACA;MACA;MACA,IAAIY,SAAS,GAAG,IAAI,GAAGC,IAAI,CAACC,GAAG,CAAC,CAAC,EAAEf,OAAO,CAAC,GAAGc,IAAI,CAACE,MAAM,CAAC,CAAC,GAAG,GAAG;MACjEhB,OAAO,IAAI,CAAC;MACZJ,GAAG,CAACqB,IAAI,CAAC,wBAAwB,CAAC;MAClCd,OAAO,GAAGe,UAAU,CAAC,YAAY;QAC/Bd,MAAM,CAACE,GAAG,EAAEC,QAAQ,EAAEC,SAAS,CAAC;MAClC,CAAC,EAAEK,SAAS,CAAC;IACf;EACF,CAAC,CAAC;EACFX,MAAM,CAACiB,SAAS;EAChB;AACF;AACA;EACE,UAAUC,IAAI,EAAE;IACd,IAAIC,OAAO,GAAGC,IAAI,CAACC,KAAK,CAACH,IAAI,CAAC;IAC9B,IAAIb,QAAQ,CAACc,OAAO,CAACG,IAAI,CAAC,EAAE;MAC1BjB,QAAQ,CAACc,OAAO,CAACG,IAAI,CAAC,CAACH,OAAO,CAACD,IAAI,EAAEC,OAAO,CAACI,MAAM,CAAC;IACtD;EACF,CAAC,CAAC;AACJ,CAAC;AACD,eAAerB,MAAM","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}